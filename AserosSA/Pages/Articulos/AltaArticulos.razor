@page "/altaArticulo"
@page "/altaArticulo/{id:int}"
@inject IJSRuntime JsRuntime
@inject NavigationManager NavigationManager
@inject ModalService _modalService
@inject MessageService _message
@inject Blazored.LocalStorage.ILocalStorageService localStorage
@using Models;
@using System.Text.Json;


<div class="rounded w-75 bg-light mx-auto" style="margin:15px;">
    <h3 class="text-center">Captura de Articulos</h3>
    <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-10">
            <table class="table">
                <tbody>
                    <tr>
                        <td>
                            <label>Clave de almacén: </label>
                            <input type="text" class="form-control" aria-label="">
                        </td>
                        <td colspan="2">
                            <label>Nombre del almacén:</label>
                            <input type="text" class="form-control" aria-label="" disabled>
                        </td>
                    </tr>
                    <tr>
                        <td class="rounded bg-info" colspan="8" style="color:white; background-color:aquamarine">
                            Datos Generales
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Clave de grupo: </label>
                            <input type="text" class="form-control" aria-label="">
                        </td>
                        <td colspan="2">
                            <label>Nombre: </label>
                            <input type="text" class="form-control" aria-label="" disabled>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Clave del articulo: </label>
                            <input type="text" class="form-control" aria-label="">
                        </td>
                        <td colspan="2">
                            <label>Descripción: </label>
                            <input type="text" class="form-control" aria-label="">
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3">
                            <label>Marca: </label>
                            <input type="text" class="form-control" aria-label="">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Clave de la ubicación: </label>
                            <input type="text" class="form-control" aria-label="">
                        </td>
                        <td colspan="2">
                            <label>Ubicación: </label>
                            <input type="text" class="form-control" aria-label="" disabled>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Clave de unidad: </label>
                            <input type="text" class="form-control" aria-label="">
                        </td>
                        <td colspan="2">
                            <label>Nombre de la unidad: </label>
                            <input type="text" class="form-control" aria-label="" disabled>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Máximo: </label>
                            <input type="text" class="form-control" aria-label="">
                        </td>
                        <td>
                            <label>Punto de Reorden: </label>
                            <input type="text" class="form-control" aria-label="">
                        </td>
                        <td>
                            <label>Minimo: </label>
                            <input type="text" class="form-control" aria-label="">
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="col-sm-11" style="text-align:right;">
            <Button Type="primary" @onclick="Save">@saveValue</Button>
            <Button Type="default" @onclick="cancel" Danger>Cancelar</Button>
        </div>
    </div>
</div>

<Form @ref="form"
      ValidateOnChange="true"
      Model="@Articulo"
      LabelColSpan="4"
      WrapperColSpan="14"
      OnFinish="OnFinish"
      OnFinishFailed="OnFinishFailed"
      Size="ntSizeLDSType.Small">
    <FormItem Label="Clave">
        <Input id="clave" @bind-Value="@context.Id" />
    </FormItem>
    <FormItem Label="Nombre">
        <Input id="nombre" @bind-Value="@context.Nombre" />
    </FormItem>
    <FormItem Label="Descripción">
        <TextArea @bind-Value="@context.Descripcion" />
    </FormItem>
    <FormItem Label="Marca">
        <Input id="marca" @bind-Value="@context.Marca" />
    </FormItem>
    <FormItem Label="Cantidad">
        <AntDesign.InputNumber id="cantidad" @bind-Value="@context.Cantidad" />
    </FormItem>
    <FormItem Label="Precio unitario">
        <Input id="precioUnitario" @bind-Value="@context.PrecioUnitario" />
    </FormItem>
    <FormItem Label="Minimo">
        <AntDesign.InputNumber id="minimo" @bind-Value="@context.Minimo" />
    </FormItem>
    <FormItem Label="Maximo">
        <AntDesign.InputNumber id="maximo" @bind-Value="@context.Maximo" />
    </FormItem>
    <FormItem Label="Punto de reorden">
        <AntDesign.InputNumber id="puntoReorden" @bind-Value="@context.PuntoReorden" />
    </FormItem>
    <FormItem Label="Unidad">
        <Select DataSource="@_unidades"
                @bind-Value="@context.UnidadId"
                ValueName="@nameof(Unidad.Id)"
                LabelName="@nameof(Unidad.Descripcion)">
        </Select>
    </FormItem>
    <FormItem Label="Almacen">
        <Select DataSource="@_almacenes"
                @bind-Value="@context.AlmacenId"
                ValueName="@nameof(Almacen.Id)"
                LabelName="@nameof(Almacen.Descripcion)">
        </Select>
    </FormItem>
    <FormItem Label="Ubicación">
        <Select DataSource="@_ubicaciones"
                @bind-Value="@context.UbicacionId"
                ValueName="@nameof(Ubicacion.Id)"
                LabelName="@nameof(Ubicacion.Descripcion)">
        </Select>
    </FormItem>


    <FormItem WrapperColSpan="16">
        <Button OnClick="Save">
            Guardar
        </Button>
        <Button @onclick="cancel" HtmlType="submit" Danger>
            Cancelar
        </Button>
    </FormItem>
</Form>

@code {
    [Parameter]
    public int id { get; set; }

    public String saveValue { get; set; }

    public string namevalue { get; set; }

    //Formulario
    AntDesign.Form<ArticuloModel> form;
    //AntDesign.Select<UnidadModel> select;
    private ArticuloModel Articulo = new ArticuloModel();
    private UnidadModel Unidad = new UnidadModel();
    private AlmacenModel Almacen = new AlmacenModel();
    private UbicacionModel Ubicacion = new UbicacionModel();
    List<UnidadModel> _unidades;
    List<AlmacenModel> _almacenes;
    List<UbicacionModel> _ubicaciones;

    protected override async Task OnInitializedAsync()
    {
        _unidades = await localStorage.GetItemAsync<List<UnidadModel>>("Unidades");
        _almacenes = await localStorage.GetItemAsync<List<AlmacenModel>>("Almacenes");
        _ubicaciones = await localStorage.GetItemAsync<List<UbicacionModel>>("Ubicaciones");

        if (id != 0)
        {
            saveValue = "Editar";
        }
        else
        {
            saveValue = "Guardar";
        }

    }

    public void OnFinishFailed() { }
    public void OnFinish() { }

    public async Task Save()
    {
        /*if (id != 0)
            await JsRuntime.InvokeAsync<object>(identifier: "swal", "Editar", "Articulos Editada correctamente");
        else
            await JsRuntime.InvokeAsync<object>(identifier: "swal", "Guardar", "Articulo Guardada correctamente");

        NavigationManager.NavigateTo("/listaArticulos");*/
        form.Validate();
        Console.WriteLine(JsonSerializer.Serialize(Articulo));
    }


    public async Task cancel()
    {
        //await JsRuntime.InvokeAsync<string>(identifier: "cancelSwal");
        var isTrue = await _modalService.ConfirmAsync(new ConfirmOptions()
        {
            Title = "Cancelar",
            Icon =@<Icon Type="exclamation-circle" Theme="Outline"></Icon>,
Content = "Seguro que deseas cancelar",
OkText = "Si",
CancelText = "Cancelar"
});

if (isTrue)
NavigationManager.NavigateTo("/listaArticulos");

}
}

